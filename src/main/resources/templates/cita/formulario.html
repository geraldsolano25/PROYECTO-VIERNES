<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{general/fragmentos :: head}">
        <title>TechShop - Agendar Cita</title>
        <meta charset="UTF-8"/>
        <style>
            .form-container {
                max-width: 600px;
                margin: 50px auto;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
                background-color: #f8f9fa;
            }
            .form-header {
                text-align: center;
                margin-bottom: 30px;
                color: #0d6efd;
            }
            .btn-submit {
                width: 100%;
                padding: 12px;
                font-size: 18px;
            }
        </style>
    </head>
    <body>
        <header th:replace="~{general/fragmentos :: header}"/>
        
        <div class="container">
            <div class="form-container">
                <div class="form-header">
                    <h1><i class="fa-solid fa-calendar-plus"></i> Agendar Cita</h1>
                    <p class="text-muted">Complete el formulario para agendar su cita</p>
                </div>
                
                <form th:action="@{/cita/guardar}" method="post" class="was-validated">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="fechaHora" class="form-label">Fecha y Hora *</label>
                            <input type="datetime-local" class="form-control" id="fechaHora" name="fechaHora" required>
                            <div class="invalid-feedback">Por favor seleccione fecha y hora.</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="cliente" class="form-label">Cliente *</label>
                        <input type="text" class="form-control" id="cliente" name="cliente" 
                               placeholder="Ingrese su nombre completo" required>
                        <div class="invalid-feedback">Por favor ingrese su nombre.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="servicio" class="form-label">Servicio *</label>
                        <select class="form-control" id="servicio" name="servicio" required>
                            <option value="">-- Seleccione un servicio --</option>
                            <option value="Reparación de computadoras">Reparación de computadoras</option>
                            <option value="Mantenimiento preventivo">Mantenimiento preventivo</option>
                            <option value="Instalación de software">Instalación de software</option>
                            <option value="Asesoría técnica">Asesoría técnica</option>
                            <option value="Venta de equipos">Venta de equipos</option>
                            <option value="Otro">Otro servicio</option>
                        </select>
                        <div class="invalid-feedback">Por favor seleccione un servicio.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="sucursal" class="form-label">Sucursal *</label>
                        <select class="form-control" id="sucursal" name="sucursal.id" required>
                            <option value="">-- Seleccione una sucursal --</option>
                            <option th:each="s : ${sucursalesActivas}"
                                    th:value="${s.id}"
                                    th:text="${s.nombre + ' - ' + s.direccion}"></option>
                        </select>
                        <div class="invalid-feedback">Por favor seleccione una sucursal.</div>
                    </div>
                    
                    <input type="hidden" name="estado" value="PENDIENTE">
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="notificacion" name="notificacion" checked>
                        <label class="form-check-label" for="notificacion">Recibir notificación por correo</label>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-submit">
                            <i class="fa-solid fa-calendar-check"></i> Confirmar Cita
                        </button>
                        <a th:href="@{/}" class="btn btn-secondary">
                            <i class="fa-solid fa-home"></i> Inicio
                        </a>
                    </div>
                    
                    <div class="mt-3 text-center text-muted">
                        <small>* Campos obligatorios</small>
                    </div>
                </form>
            </div>
        </div>
        
        <section th:replace="~{general/fragmentos :: mostrarToast}"/>
        <footer th:replace="~{general/fragmentos :: footer}"/>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const fechaInput = document.getElementById('fechaHora');
                
                // Calcular fecha de mañana a las 9:00 AM
                const manana = new Date();
                manana.setDate(manana.getDate() + 1);
                manana.setHours(9, 0, 0, 0);
                
                // Formatear para datetime-local (YYYY-MM-DDThh:mm)
                const year = manana.getFullYear();
                const month = String(manana.getMonth() + 1).padStart(2, '0');
                const day = String(manana.getDate()).padStart(2, '0');
                const hours = String(manana.getHours()).padStart(2, '0');
                const minutes = String(manana.getMinutes()).padStart(2, '0');
                
                const fechaDefault = `${year}-${month}-${day}T${hours}:${minutes}`;
                const fechaMinima = `${year}-${month}-${day}T08:00`;
                
                // Establecer valor por defecto
                fechaInput.value = fechaDefault;
                fechaInput.min = fechaMinima;
                
                // Validación de hora laboral
                fechaInput.addEventListener('change', function() {
                    const fechaHora = new Date(this.value);
                    const hora = fechaHora.getHours();
                    if (hora < 8 || hora > 18) {
                        alert('Las citas solo están disponibles entre las 8:00 y 18:00 horas');
                        this.value = fechaDefault;
                    }
                });
            });
        </script>
    </body>
</html>